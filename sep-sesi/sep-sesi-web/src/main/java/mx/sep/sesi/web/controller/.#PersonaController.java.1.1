/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package mx.sep.sesi.web.controller;

import java.io.File;
import java.io.FileInputStream;
import mx.sep.seguridad.modelo.UsuarioSeguridad;
import mx.sep.seguridad.util.SeguridadUtil;
import mx.sep.sesi.datos.vo.PersonaVO;
import mx.sep.sesi.servicios.PersonaService;
import mx.sep.sesi.servicios.util.LoggerUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;

/**
 *
 * @author heriberto.perez
 */
@Controller
@RequestMapping(value = "/persona")
public class PersonaController {

    @Autowired
    private PersonaService personaService;

    @RequestMapping(value = "/insertaEmpleado", method = RequestMethod.POST)
    @ResponseBody
    public String insertaEmpleado(@RequestParam String curp, @RequestParam String nombre, @RequestParam String primerApellido, @RequestParam String segundoApellido, @RequestParam Short inmueble, @RequestParam Short ur, @RequestParam Short cuadrante, @RequestParam String puesto, @RequestParam Short tipoSangre,
            @RequestParam String emergencia, @RequestParam Short alergias, @RequestParam Short enfermedad, @RequestParam("file") MultipartFile file) throws Exception {
        System.out.println("entrando a controller");
        System.out.println("File:" + file.getOriginalFilename());
        System.out.println("Tamaño:" + file.getSize());
        System.out.println("ContentType:" + file.getContentType());
        UsuarioSeguridad us = SeguridadUtil.getUsuarioActual();
        LoggerUtil.debug(this, "USERNAME " + us.getUsername());
        PersonaVO personaVO = new PersonaVO();
        personaVO.setCurp(curp);
        personaVO.setNombre(nombre);
        personaVO.setPrimerApellido(primerApellido);
        personaVO.setSegundoApellido(segundoApellido);
        personaVO.setIdInmueble(inmueble);
        personaVO.setIdUR(ur);
        personaVO.setCuadrante(cuadrante);
        personaVO.setPuesto(puesto);
        personaVO.setTipoSangre(tipoSangre);
        personaVO.setEmergencia(emergencia);
        personaVO.setIdAlergia(alergias);
        personaVO.setEnfermedad(enfermedad);
        personaVO.setImagen(file.getBytes());
        String response = personaService.insertaEmpleado(personaVO);
        return "{\"msg\":\"" + response + "\"}";
    }
    
    @RequestMapping(value = "/insertaProveedor", method = RequestMethod.POST)
    @ResponseBody
    public String insertaProveedor(@RequestParam String curp, @RequestParam String nombre, @RequestParam String primerApellido, @RequestParam String segundoApellido, @RequestParam Short inmueble, @RequestParam Short ur, @RequestParam Short cuadrante, @RequestParam String puesto, @RequestParam Short tipoSangre,
            @RequestParam String emergencia, @RequestParam Short alergias, @RequestParam Short enfermedad, @RequestParam("file") MultipartFile file) throws Exception {
        System.out.println("entrando a controller");
        System.out.println("File:" + file.getOriginalFilename());
        System.out.println("Tamaño:" + file.getSize());
        System.out.println("ContentType:" + file.getContentType());
        UsuarioSeguridad us = SeguridadUtil.getUsuarioActual();
        LoggerUtil.debug(this, "USERNAME " + us.getUsername());
        PersonaVO personaVO = new PersonaVO();
        personaVO.setCurp(curp);
        personaVO.setNombre(nombre);
        personaVO.setPrimerApellido(primerApellido);
        personaVO.setSegundoApellido(segundoApellido);
        personaVO.setIdInmueble(inmueble);
        personaVO.setIdUR(ur);
        personaVO.setCuadrante(cuadrante);
        personaVO.setPuesto(puesto);
        personaVO.setTipoSangre(tipoSangre);
        personaVO.setEmergencia(emergencia);
        personaVO.setIdAlergia(alergias);
        personaVO.setEnfermedad(enfermedad);
        personaVO.setImagen(file.getBytes());
        String response = personaService.insertaProveedor(personaVO);
        return "{\"msg\":\"" + response + "\"}";
    }

}
